#!/usr/bin/env ruby

require 'ppcurses'
require 'rubygems'
require 'sqlite3'

require_relative '../lib/rb/tallyman'

load '../config/config.properties'

def get_data(db)
  lift_rep_menu = PPCurses::RadioMenu.new( @liftReps , nil )
  lift_type_menu = PPCurses::Menu.new( @lifts, nil )

  lifts_menu = PPCurses::CompositeMenu.new( lift_type_menu, lift_rep_menu )
  add_lift_action = LiftAction.new( lift_type_menu, lift_rep_menu, db )

  lift_type_menu.set_global_action(add_lift_action)

  book_action = BookAction.new(db)
  music_action = MusicAction.new(db)

  lifts_action = PPCurses::ShowMenuAction.new(lifts_menu)
  count_action = CountAction.new(db)
  count_menu_action = PPCurses::ShowMenuAction.new(count_action.menu)

  main_menu = PPCurses::Menu.new( @mainMenuValues ,
                       [ lifts_action, music_action, book_action, count_menu_action] )

  main_menu.show()
  main_menu.menu_selection()
  
  main_menu.close()
end

db = DatabaseProxy.open( @dbName )

begin

  screen = PPCurses::Screen.new()
  screen.run { get_data(db) }
rescue SystemExit, Interrupt
  # Empty Catch block so ruby doesn't puke out
  # a stack trace when CTRL-C is used
ensure
  db.close if db
end

print 'Modified tables'
print db.modified_table_set.to_a().to_s


# adminInterface return values:
# ----------------------------
# 0 - interface ran but nothing inserted
# 1 - an error occurred running the interface
# 2 - 1 or more insert statements to the database occurred
#
exit db.exit_code